<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
  <!-- Fallback if layout is missing -->
  <meta charset="utf-8">
  <title>Login - Library App</title>
</head>

<style>
  :root { --theme-green: #28c76f; }
  
  body { 
    background-color: #f8f8f8; 
    font-family: 'Inter', sans-serif;
  }
  
  .login-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 24px 0 rgba(34, 41, 47, 0.1);
    background-color: white;
    width: 100%;
    max-width: 450px;
    padding: 2.5rem;
  }

  .form-control:focus {
    border-color: var(--theme-green);
    box-shadow: 0 0 0 0.25rem rgba(40, 199, 111, 0.2);
  }

  .btn-success { 
    background-color: var(--theme-green); 
    border-color: var(--theme-green); 
    padding: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(40, 199, 111, 0.4);
    transition: all 0.2s;
  }
  
  .btn-success:hover { 
    background-color: #24b263; 
    transform: translateY(-2px);
  }
  
  .text-theme { color: var(--theme-green); }
</style>

<body>

  <!-- Centered Container -->
  <div class="d-flex align-items-center justify-content-center min-vh-100 px-3">
    
    <div class="login-card">
      
      <!-- Brand Logo -->
      <div class="text-center mb-4">
        <div class="d-flex align-items-center justify-content-center gap-2 mb-2">
           <i class="bi bi-layers-fill fs-2 text-theme"></i>
           <span class="fs-3 fw-bold text-dark">Library App</span>
        </div>
        <p class="text-muted small">Welcome back, please login to your account.</p>
      </div>

      <!-- Login Form -->
      <form id="firebaseLoginForm">
        
        <div class="mb-3">
          <label class="form-label small fw-bold text-muted">EMAIL</label>
          <input id="loginEmail" type="email" class="form-control bg-light border-0 py-2" placeholder="admin@library.com" required>
        </div>
        
        <div class="mb-4">
          <div class="d-flex justify-content-between">
            <label class="form-label small fw-bold text-muted">PASSWORD</label>
            <a href="#" class="small text-theme text-decoration-none">Forgot Password?</a>
          </div>
          <input id="loginPassword" type="password" class="form-control bg-light border-0 py-2" placeholder="••••••••" required>
        </div>
        
        <div class="d-grid mb-4">
          <button id="loginBtn" type="submit" class="btn btn-success text-white rounded-3">Sign In</button>
        </div>

        <!-- Error Message Container -->
        <div id="loginMsg" class="text-center small text-danger mb-3"></div>
        
        <div class="text-center">
          <span class="text-muted small">New on our platform?</span>
          <a href="#" class="text-theme small text-decoration-none fw-bold ms-1">Create an account</a>
        </div>
        
        <div class="my-4 d-flex align-items-center">
           <hr class="flex-grow-1">
           <span class="mx-2 small text-muted">or</span>
           <hr class="flex-grow-1">
        </div>
        
        <div class="d-flex gap-2 justify-content-center">
          <button type="button" class="btn btn-light border rounded-circle"><i class="bi bi-google text-danger"></i></button>
          <button type="button" class="btn btn-light border rounded-circle"><i class="bi bi-facebook text-primary"></i></button>
          <button type="button" class="btn btn-light border rounded-circle"><i class="bi bi-twitter text-info"></i></button>
        </div>

      </form>

    </div>

  </div>

  <script th:replace="~{layout :: scripts}"></script>

  <!-- FIREBASE LOGIC -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // Your Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDX0X1bD36A669a2km7MSyLY0RiNDTe-D8",
      authDomain: "library-java.firebaseapp.com",
      projectId: "library-java",
      storageBucket: "library-java.firebasestorage.app",
      messagingSenderId: "164941489724",
      appId: "1:164941489724:web:0a6f0e039896f0816c4539",
      measurementId: "G-8X91X0DVP9"
    };

    // Initialize
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const form = document.getElementById('firebaseLoginForm');
    const msg = document.getElementById('loginMsg');
    const btn = document.getElementById('loginBtn');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      // Loading state
      btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Signing in...';
      btn.disabled = true;
      msg.textContent = "";

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Success
          msg.className = "text-center small text-success mb-3";
          msg.innerHTML = '<i class="bi bi-check-circle-fill"></i> Success! Redirecting...';
          
          setTimeout(() => {
             window.location.href = "/dashboard";
          }, 1000);
        })
        .catch((error) => {
          // Error
          console.error(error);
          btn.innerHTML = 'Sign In';
          btn.disabled = false;
          msg.className = "text-center small text-danger mb-3";
          
          if(error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found') {
             msg.textContent = "Invalid email or password.";
          } else if(error.code === 'auth/too-many-requests') {
             msg.textContent = "Too many failed attempts. Try again later.";
          } else {
             msg.textContent = "Login failed. Check console.";
          }
        });
    });
  </script>

</body>
</html>